fflush($fp);            // flush output before releasing the lock
flock($fp, LOCK_UN);
fclose($fp);